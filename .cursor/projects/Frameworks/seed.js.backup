const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const DB_PATH = path.join(__dirname, 'database.sqlite');
const db = new sqlite3.Database(DB_PATH);

// Default onboarding framework steps
// You can customize these based on your actual framework
const defaultSteps = [
    {
        title: "Pre-arrival Preparation",
        description: "Complete all pre-arrival documentation and setup tasks before the new staff member's first day",
        category: "preparation",
        step_order: 1
    },
    {
        title: "Welcome & Orientation",
        description: "Provide welcome package, office tour, and initial orientation to company culture and values",
        category: "preparation",
        step_order: 2
    },
    {
        title: "IT Setup & Access",
        description: "Set up computer, email, software licenses, and access to necessary systems and tools",
        category: "preparation",
        step_order: 3
    },
    {
        title: "HR Paperwork",
        description: "Complete employment contracts, tax forms, benefits enrollment, and other required documentation",
        category: "documentation",
        step_order: 4
    },
    {
        title: "Company Policies Training",
        description: "Review and acknowledge company policies including code of conduct, safety, and security policies",
        category: "training",
        step_order: 5
    },
    {
        title: "Role-Specific Training",
        description: "Provide training on job-specific responsibilities, tools, and processes",
        category: "training",
        step_order: 6
    },
    {
        title: "Team Introduction",
        description: "Introduce to team members, key stakeholders, and establish initial working relationships",
        category: "integration",
        step_order: 7
    },
    {
        title: "Mentor Assignment",
        description: "Assign a mentor or buddy to help guide the new staff member through their first weeks",
        category: "integration",
        step_order: 8
    },
    {
        title: "First Project Assignment",
        description: "Assign initial project or tasks to begin hands-on work and learning",
        category: "integration",
        step_order: 9
    },
    {
        title: "30-Day Check-in",
        description: "Conduct first formal check-in to assess progress, address concerns, and gather feedback",
        category: "review",
        step_order: 10
    },
    {
        title: "90-Day Review",
        description: "Complete comprehensive review of performance, integration, and overall onboarding experience",
        category: "review",
        step_order: 11
    }
];

db.serialize(() => {
    // Clear existing steps
    db.run('DELETE FROM steps', (err) => {
        if (err) {
            console.error('Error clearing steps:', err.message);
            return;
        }
        console.log('Cleared existing steps');
    });

    // Insert default steps
    const stmt = db.prepare(`
        INSERT INTO steps (id, title, description, leader, category, completed, created_at, step_order)
        VALUES (?, ?, ?, ?, ?, 0, ?, ?)
    `);

    defaultSteps.forEach((step, index) => {
        const id = `step-${Date.now()}-${index}`;
        const now = new Date().toISOString();
        stmt.run(
            id,
            step.title,
            step.description,
            null, // leader - to be assigned
            step.category,
            now,
            step.step_order
        );
    });

    stmt.finalize((err) => {
        if (err) {
            console.error('Error seeding database:', err.message);
        } else {
            console.log(`Successfully seeded ${defaultSteps.length} steps`);
        }
        db.close();
    });
});
